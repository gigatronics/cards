<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Risk Analyzer</title>
  <style>
    body { font-family: sans-serif; padding: 40px; max-width: 600px; margin: auto; }
    textarea { width: 100%; height: 150px; }
    .result { margin-top: 20px; }
    .score { font-size: 1.5em; font-weight: bold; }
    .expandable { margin-top: 10px; cursor: pointer; color: blue; text-decoration: underline; }
    .explanation { display: none; margin-top: 5px; background: #f2f2f2; padding: 10px; border-radius: 4px; }
  </style>
</head>
<body>

<h2>Risk Score Analyzer</h2>
<textarea id="inputText" placeholder="Enter text to analyze..."></textarea>
<br><br>
<button onclick="submitText()">Analyze</button>

<div class="result" id="resultContainer" style="display: none;">
  <div class="score" id="riskScore"></div>
  <div class="expandable" onclick="toggleExplanation()">Show Explanation</div>
  <div class="explanation" id="explanationText"></div>
</div>

<script>
  async function submitText() {
    const text = document.getElementById('inputText').value;
    const response = await fetch('http://localhost:8000/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: text })
    });
    const data = await response.json();

    document.getElementById('riskScore').textContent = `Risk Score: ${data.risk_score}`;
    document.getElementById('explanationText').innerHTML = formatExplanation(data.explanation);
    document.getElementById('resultContainer').style.display = 'block';
  }

  function toggleExplanation() {
    const el = document.getElementById('explanationText');
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
  }

  function formatExplanation(explanation) {
    return `<strong>Main Reason:</strong> ${explanation.main_reason}<br><br>
            <strong>Details:</strong><ul>${
              Object.entries(explanation.details).map(([key, val]) => 
                `<li><strong>${key}:</strong> ${Array.isArray(val) ? val.join(', ') : val}</li>`
              ).join('')
            }</ul>`;
  }
</script>

</body>
</html>
